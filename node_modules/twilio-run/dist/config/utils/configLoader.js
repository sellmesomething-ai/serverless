"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConfig = void 0;
const cosmiconfig_1 = require("cosmiconfig");
const json5_1 = require("../../utils/json5");
const logger_1 = require("../../utils/logger");
const debug = (0, logger_1.getDebugFunction)('twilio-run:config:configLoader');
const DEFAULT_MODULE_NAME = 'twilioserverless';
const configExplorer = (0, cosmiconfig_1.cosmiconfigSync)(DEFAULT_MODULE_NAME, {
    loaders: {
        '.json5': json5_1.json5Loader,
        '.json': json5_1.json5Loader,
        noExt: json5_1.json5Loader,
    },
});
let config;
function getConfig(baseDir, configPath) {
    debug('Load config');
    if (config) {
        debug('Config cached in memory');
        return config;
    }
    const result = configPath
        ? configExplorer.load(configPath)
        : configExplorer.search(baseDir);
    if (!result) {
        debug('Could not find config. Defaulting to {}');
        config = {};
    }
    else {
        debug('Config found at %s', result.filepath);
        config = result.config;
    }
    return config;
}
exports.getConfig = getConfig;
